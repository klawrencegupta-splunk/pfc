<form theme="dark">
  <label>DM_splunk_ops_view1</label>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="field2">
      <label></label>
      <default>
        <earliest>0</earliest>
        <latest></latest>
      </default>
    </input>
    <input type="dropdown" token="customer" searchWhenChanged="true">
      <label>Customer</label>
      <fieldForLabel>customer</fieldForLabel>
      <fieldForValue>customer</fieldForValue>
      <search>
        <query>| inputlookup host_role.csv |  fields customer | dedup customer</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
    </input>
    <input type="dropdown" token="role" searchWhenChanged="true">
      <label>Role</label>
      <fieldForLabel>role</fieldForLabel>
      <fieldForValue>role</fieldForValue>
      <search>
        <query>| inputlookup host_role.csv |  fields customer role | dedup role</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
    </input>
    <input type="multiselect" token="host_short_name" searchWhenChanged="true">
      <label>Host</label>
      <valuePrefix>DM_splunkops.host_short_name=</valuePrefix>
      <delimiter> OR </delimiter>
      <fieldForLabel>host_short_name</fieldForLabel>
      <fieldForValue>host_short_name</fieldForValue>
      <search>
        <query>| inputlookup host_role.csv | fields customer host_short_name role | search customer=$customer$ AND role=$role$ | fields host_short_name | dedup host_short_name</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Total Queue Blocks Reported</title>
      <table>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false values("DM_splunkops.blocked") as "Distinct Values of blocked", count("DM_splunkops.blocked") as "Count of blocked" FROM datamodel=DM_splunkops.DM_splunkops WHERE (nodename=DM_splunkops "DM_splunkops.customer"=CustomerX "DM_splunkops.host_short_name"="*" "DM_splunkops.blocked"=true) BY "DM_splunkops.host_short_name" | search $host_short_name$ | stats dedup_splitvals=t count(DM_splunkops.blocked) AS "Blocked" by DM_splunkops.host_short_name</query>
          <earliest>$field2.earliest$</earliest>
          <latest>$field2.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
    <panel>
      <title>ERRORs by Component</title>
      <chart>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false count as "Count of DM_splunkops" FROM datamodel=DM_splunkops.DM_splunkops WHERE (nodename=DM_splunkops "DM_splunkops.customer"=CustomerX "DM_splunkops.log_level"=ERROR "DM_splunkops.host_short_name"="*") BY "DM_splunkops.component" DM_splunkops.host_short_name | search $host_short_name$ | stats dedup_splitvals=t count AS "Count of DM_splunkops" by DM_splunkops.component DM_splunkops.host_short_name | sort limit=100 DM_splunkops.component | fields - _span | rename "DM_splunkops.component" as component | fillnull "Count of DM_splunkops" | fields + component, "Count of DM_splunkops" DM_splunkops.host_short_name</query>
          <earliest>$field2.earliest$</earliest>
          <latest>$field2.latest$</latest>
        </search>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisTitleY2.visibility">collapsed</option>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">603</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">1</option>
        <option name="trellis.size">small</option>
        <option name="trellis.splitBy">DM_splunkops.host_short_name</option>
      </chart>
    </panel>
    <panel>
      <title>WARNs by Component</title>
      <chart>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false count as "Count of DM_splunkops" FROM datamodel=DM_splunkops.DM_splunkops WHERE (nodename=DM_splunkops "DM_splunkops.customer"=CustomerX "DM_splunkops.log_level"=WARN "DM_splunkops.host_short_name"="*") BY "DM_splunkops.component" DM_splunkops.host_short_name | search $host_short_name$ | stats dedup_splitvals=t count AS "Count of DM_splunkops" by DM_splunkops.component DM_splunkops.host_short_name | sort limit=100 DM_splunkops.component | fields - _span | rename "DM_splunkops.component" as component | fillnull "Count of DM_splunkops" | fields + component, "Count of DM_splunkops" DM_splunkops.host_short_name</query>
          <earliest>$field2.earliest$</earliest>
          <latest>$field2.latest$</latest>
        </search>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisTitleY2.visibility">collapsed</option>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">593</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">1</option>
        <option name="trellis.size">small</option>
        <option name="trellis.splitBy">DM_splunkops.host_short_name</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Spunk Q-fills - 50 perc - needs bins really</title>
      <chart>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false max("DM_resourcelogdata.q_perc_filled") as "% Fill" FROM datamodel=DM_resourcelogdata.DM_resourcelogdata WHERE (nodename=DM_resourcelogdata "DM_resourcelogdata.host_short_name"="*" "DM_resourcelogdata.q_perc_filled"=*) BY "DM_resourcelogdata.host_short_name", "DM_resourcelogdata.name" | search [| inputlookup host_role.csv | fields host_short_name role customer host_short_name | search customer=$customer$ | search role=$role$ | fields host_short_name | rename host_short_name AS DM_resourcelogdata.host_short_name]  | chart dedup_splitvals=t limit=100 max(DM_resourcelogdata.q_perc_filled) AS "% Fill" over "DM_resourcelogdata.name" by  DM_resourcelogdata.host_short_name</query>
          <earliest>$field2.earliest$</earliest>
          <latest>$field2.latest$</latest>
        </search>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisTitleY2.visibility">collapsed</option>
        <option name="charting.chart">bar</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">1</option>
        <option name="trellis.size">medium</option>
        <option name="trellis.splitBy">DM_resourcelogdata.name</option>
      </chart>
    </panel>
    <panel>
      <table>
        <title>Problem Events Found</title>
        <search>
          <query>index=pfc eventtype=incomplete_search_results OR eventtype=tcpinputproc_broken_pipes [| inputlookup host_role.csv | fields host_short_name role customer host_short_name | search customer=$customer$ | search role=$role$ | fields host_short_name] | stats count by eventtype host_short_name</query>
          <earliest>$field2.earliest$</earliest>
          <latest>$field2.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
</form>