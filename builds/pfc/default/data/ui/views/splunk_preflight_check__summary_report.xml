<form>
  <label>Splunk Pre-Flight Check - Summary Report</label>
  <description>Splunk Pre-Flight Check - Summary Report</description>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="field1" searchWhenChanged="true">
      <label>Time Ranage</label>
      <default>
        <earliest>0</earliest>
        <latest></latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Deployment Summary Table</title>
      <html depends="$alwaysHideCSSStyle$">
    <style>
       .table th {
          background-image: linear-gradient(to bottom, #34495E, #000000) !important;
          text-shadow: none !important;
       }
       .table th a{
          color: white !important;
       }
      table tr.odd td{
        background: #F8F9F9 !important;
      }
      table tr.even td{
        background: #CACFD2 !important;
      }
      table tr td{
        color: #000000 !important;
      }
    </style>
  </html>
      <table>
        <search>
          <query>index=pfc (sourcetype=splunkd_log AND site) OR (sourcetype=metrics_log sourceHost OR Peer_Count) OR (sourcetype="peers_csv") OR (sourcetype=audit_log action=search "search/jobs/" NOT "search/jobs/16*") 
| rex field=_raw "remote.(?&lt;origin_sh&gt;.{1,25})_subsearch" 
| eval index_count=mvcount(split(searchable_indexes,","))-1 
| stats dc(origin_sh) AS "# of SH" max(Peer_Count) AS "# of IDX" dc(sourceHost) AS "Forwarder count" max(index_count) AS "Index Count"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Diag File Host Information</title>
      <table>
        <search>
          <query>index=pfc sourcetype="resource_usage_log" OR (sourcetype=systeminfo_txt AND build) | stats max(data.cpu_count) AS phys_cpu max(data.virtual_cpu_count) AS vcpu max(data.mem) AS mem_kb max(data.splunk_version) AS  splunk_version by host_short_name host | eval phys_cpu=tonumber(phys_cpu) | eval vcpu=tonumber(vcpu)  | eval ht_status=if(vcpu&gt;phys_cpu,"HT enabled", "HT NOT Enabled") | lookup host_role.csv host_short_name OUTPUT role | eval "Memory GB"=mem_kb/1024  | table host host_short_name role splunk_version ht_status phys_cpu vcpu "Memory GB" splunk_version | rename host AS "Diag File Path" | rename role AS Role | rename splunk_version AS "Splunk Version" | rename ht_status AS "Hyper-Threading Status" | rename phys_cpu AS "Physical CPUs" | rename vcpu AS "vCPU"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
    <panel>
      <title>Searches Per Day</title>
      <table>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false dc("DM_searchdata.data.search_props.sid") as "Distinct Count of data.search_props.sid" FROM datamodel=DM_searchdata.DM_searchdata WHERE nodename=DM_searchdata BY _time span=1d DM_searchdata.host_short_name | eval "DM_searchdata.data.search_props.app"='DM_searchdata.data.search_props.app', host_short_name='DM_searchdata.host_short_name' | eval _time='_time' | timechart dedup_splitvals=t dc(DM_searchdata.data.search_props.sid) AS dc_sids span=1d  | sort limit=0 _time | fields + _time, dc_sids | eval dc_sids=tonumber(dc_sids) | where dc_sids&gt;0</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <single>
        <title>Size of Lookups in MB</title>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false max("DM_searchdata.size") as "Max of lookup_table_size" FROM datamodel=DM_searchdata.DM_searchdata WHERE nodename=DM_searchdata BY "DM_searchdata.table" DM_searchdata.host_short_name | eval "DM_searchdata.data.search_props.app"='DM_searchdata.data.search_props.app', host_short_name='DM_searchdata.host_short_name'  | stats dedup_splitvals=t max(DM_searchdata.size) AS lookup_table_size by "DM_searchdata.table" | eval lookup_table_size_mb=round(lookup_table_size/1024/1024,1) | stats sum(lookup_table_size_mb)</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>
    <panel>
      <single>
        <title># of DMAs</title>
        <search>
          <query>index=pfc sourcetype="audit_log" savedsearch_name="_ACCELERATE_DM*" | stats dc(savedsearch_name)</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>
    <panel>
      <single>
        <title># of search skip events</title>
        <search>
          <query>index=pfc eventtype="searches_skipped_true"| stats count by eventtype | table count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>
    <panel>
      <title>Total App Count</title>
      <single>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false count as "Count of DM_searchdata" FROM datamodel=DM_searchdata.DM_searchdata WHERE nodename=DM_searchdata BY "DM_searchdata.data.search_props.app" | stats dedup_splitvals=t count AS "Count of DM_searchdata" by DM_searchdata.data.search_props.app | sort limit=10000 "Count of DM_searchdata" | fields - _span | rename "DM_searchdata.data.search_props.app" as "data.search_props.app" | fillnull "Count of DM_searchdata" | fields + "data.search_props.app" | sort +"data.search_props.app" | stats dc("data.search_props.app") AS "App Count"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">Apps Found</option>
      </single>
    </panel>
    <panel>
      <single>
        <title># of Users</title>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false dc("DM_searchdata.user") as "Distinct Count of user" FROM datamodel=DM_searchdata.DM_searchdata WHERE nodename=DM_searchdata | stats dedup_splitvals=t dc(DM_searchdata.user) AS "Distinct Count of user"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>App List</title>
      <table>
        <search>
          <query>index=pfc sourcetype=app_conf | rex field=app_conf_name "(?&lt;appid&gt;.+)\/\w+" | stats max(version) AS installed_version by appid | lookup splunkbase_app_stats_small.csv appid OUTPUT title support version | rename version AS latest_splunk_base_version | sort +appid</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Resource Summary</title>
      <table>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false values("DM_resourcelogdata.data.cpu_idle_pct") as "values of data.cpu_idle_pct", values("DM_resourcelogdata.data.avg_total_ms") as "values of data.avg_total_ms", values("DM_resourcelogdata.data.mem_perc_used") as "values of Memory % used" FROM datamodel=DM_resourcelogdata.DM_resourcelogdata WHERE (nodename=DM_resourcelogdata "DM_resourcelogdata.host_short_name"="*") BY "DM_resourcelogdata.host_short_name" | stats dedup_splitvals=t values(DM_resourcelogdata.data.cpu_idle_pct) AS CPU values(DM_resourcelogdata.data.avg_total_ms) AS STORAGE values(DM_resourcelogdata.data.mem_perc_used) AS MEM by DM_resourcelogdata.host_short_name | stats perc25(CPU) AS CPU perc25(MEM) AS MEM perc75(STORAGE) AS STORAGE by DM_resourcelogdata.host_short_name
| eval "CPU Availability Status"=if(CPU&gt;45.00, "OK" ,"CPU Exhaustion") 
| eval "Memory Availability Status"=if(MEM&lt;35.00, "OK" ,"High Memory Utilization")
| eval "Storage Availability Status"=if(STORAGE&lt;10.00, "OK" ,"Storage Contention")
| rename DM_resourcelogdata.host_short_name AS host_short_name | lookup host_role.csv host_short_name OUTPUT role
| table host_short_name role *Status CPU MEM STORAGE</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Splunk Queue Blocks Reported</title>
      <table>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false values("DM_splunkops.blocked") as "Distinct Values of blocked", count("DM_splunkops.blocked") as "Count of blocked" FROM datamodel=DM_splunkops.DM_splunkops WHERE (nodename=DM_splunkops "DM_splunkops.host_short_name"="*") BY "DM_splunkops.host_short_name" | stats dedup_splitvals=t count(DM_splunkops.blocked) AS block_count by DM_splunkops.host_short_name | eval "Blocked Status"=if(searchmatch("block_count&gt;0"), "Blocked Queues", "No Blocks") | table DM_splunkops.host_short_name block_count | rename DM_splunkops.host_short_name AS host_short_name | sort -block_count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <title>Splunk Problem Events</title>
      <table>
        <search>
          <query>index=pfc eventtype=incomplete_search_results OR eventtype=tcpinputproc_broken_pipes OR eventtype=server_info_long_response_time OR eventtype=searches_skipped_true OR eventtype=time_skew_found | stats count by eventtype host_short_name | lookup host_role.csv host_short_name OUTPUT role | sort -count | lookup eventtypes.csv eventtype OUTPUT eventtype_desc_name | table eventtype_desc_name host_short_name count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>
</form>