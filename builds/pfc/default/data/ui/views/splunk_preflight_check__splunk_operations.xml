<form stylesheet="tabs.css">
  <label>Splunk Pre-Flight Check - Splunk Operations</label>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="field1">
      <label>Time Range</label>
      <default>
        <earliest>0</earliest>
        <latest></latest>
      </default>
    </input>
  </fieldset>
  <row id="tabs">
    <panel>
      <html> 
      <ul id="tabs" class="nav nav-tabs"> 
      <li> <a href="/app/pfc/pfc_lander" class="toggle-tab" data-toggle="tab">Landing Page</a> </li> 
      <li> <a href="/app/pfc/splunk_preflight_check__resource_utilization" class="toggle-tab" target="_self">Resource Usage</a> </li>  
      <li class="active"> <a href="/app/pfc/splunk_preflight_check__splunk_operations" class="toggle-tab" data-toggle="tab" target="_self">Splunk Operations</a> </li> 
      <li> <a href="/app/pfc/splunk_preflight_check__splunk_search_analysis" class="toggle-tab" data-toggle="tab" target="_self">Splunk Search Review</a> </li> 
       <li> <a href="/app/pfc/splunk_preflight_check__summary_report" class="toggle-tab" data-toggle="tab" target="_self">Splunk PFC Summary Report</a> </li> </ul>
      </html>
    </panel>
  </row>
  <row>
    <panel id="readme">
      <html>
  <head>
  </head>
        <span style="font-family: Avenir;">
    <h2>Splunk Pre-Flight Check - Splunk
        Operations</h2>
        </span>
    <h1>
          <span style="font-family: Avenir;"/>
        </h1>
    <p>
          <span style="font-family: Avenir;">Splunk deployments log a considerable
        amount of data about internal operations and performance. This view
        gives deployment level insight by reviewing the following:
      </span>
        </p>
    <span style="font-family: Avenir;">
          <u>
            <strong>Queue Blocks</strong>
          </u> <i>*drill-down
        by host for specific queue usage data</i>
    </span>
    <span style="font-family: Avenir;">When Splunk queues are blocked this a key
      indicator that a deployment also has the following conditions:
    </span>
    <ul>
      <li>
            <span style="font-family: Avenir;">Storage Contention or CPU
          Exhaustion is likley to be found</span>
          </li>
      <li>
            <span style=" font-family: Avenir;">Data Latency
        </span>
          </li>
      <li>
            <span style="font-family: Avenir;">Data parsing and/or data quality
          issues present.</span>
          </li>
    </ul>
    <p>
          <u>
            <strong>
              <span style="font-family: Avenir;">Splunk Problem Events Found</span>
            </strong>
          </u>
        </p>
    <ul>
      <li>
            <span style="font-family: Avenir;">A collection of known issues
          (defined by eventtypes) that find specific problems found to impact
          the health of a Splunk deployment</span>
          </li>
    </ul>
    <p>
          <span style="font-family: Avenir;"/>
        </p>
    <span style="font-family: Avenir;">
          <u>
            <b>Index Volume Activity</b>
          </u>
    </span>
    <ul>
      <li>
            <span style="font-family: Avenir;">Total GB Indexed (during the diag
          sample period) by Index</span>
          </li>
    </ul>
    <span style=" font-family: Avenir;">
          <u>
            <b>Top 10 ERRORs and WARNs by
          Component</b>
          </u> <i>*drill-down by component to counts by event
        message.</i>
    </span>
</html>
    </panel>
    <panel id="deploymentinfo">
      <title>Splunk Queue Blocks by Host</title>
      <html>
      <style>
          #readme{
            width:20% !important;
          }
          #error_warns_table{
            width:35% !important; 
            }
          #deploymentinfo{
            width:45% !important;
          }
          #hidden_drilldown_2{
            width:50% !important;
          }
          #hidden_drilldown{
            width:50% !important;
          }
        </style>
        </html>
      <chart>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false values("DM_splunkops.blocked") as "Distinct Values of blocked", count("DM_splunkops.blocked") as "Count of blocked" FROM datamodel=DM_splunkops.DM_splunkops WHERE (nodename=DM_splunkops "DM_splunkops.host_short_name"="*") BY "DM_splunkops.host_short_name" | stats dedup_splitvals=t count(DM_splunkops.blocked) AS block_count by DM_splunkops.host_short_name | eval "Blocked Status"=if(searchmatch("block_count&gt;0"), "Blocked Queues", "No Blocks") | table DM_splunkops.host_short_name block_count | rename DM_splunkops.host_short_name AS host_short_name | sort -block_count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.chart">bar</option>
        <option name="height">500</option>
        <drilldown>
          <set token="tok_cell">$click.value$</set>
          <link>#hidden_drilldown</link>
        </drilldown>
      </chart>
      <html depends="$alwaysHideCSSStyle$">
    <style>
       .table th {
          background-image: linear-gradient(to bottom, #34495E, #34495E) !important;
          text-shadow: none !important;
       }
       .table th a{
          color: white !important;
       }
      table tr.odd td{
        background: #F8F9F9 !important;
      }
      table tr.even td{
        background: #CACFD2 !important;
      }
      table tr td{
        color: #00000 !important;
      }
    </style>
  </html>
      <table>
        <title>Splunk Problem Events Found</title>
        <search>
          <query>index=pfc eventtype=incomplete_search_results OR eventtype=tcpinputproc_broken_pipes OR eventtype=server_info_long_response_time OR eventtype=searches_skipped_true OR eventtype=time_skew_found | stats count by eventtype host_short_name | lookup host_role.csv host_short_name OUTPUT role | sort -count | lookup eventtypes.csv eventtype OUTPUT eventtype_desc_name | table eventtype_desc_name host_short_name count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
    <panel id="error_warns_table">
      <title>Sample of Index Volume Activity *metrics.log</title>
      <chart>
        <title>representative % of data by index</title>
        <search>
          <query>index=pfc sourcetype="metrics_log" group=per_index_thruput | eval gb=round(kb/1024/1024,2) | bucket _time span=1d | stats sum(gb) AS gb by series | where gb&gt;0</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">all</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <condition field="host_short_name">
            <set token="tok_cell">$click.value$</set>
          </condition>
        </drilldown>
      </chart>
      <chart>
        <title>Top 10 - ERRORs by Component</title>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false count as "Count of DM_splunkops" FROM datamodel=DM_splunkops.DM_splunkops WHERE (nodename=DM_splunkops "DM_splunkops.log_level"=ERROR "DM_splunkops.host_short_name"="*") BY "DM_splunkops.component" DM_splunkops.host_short_name | stats dedup_splitvals=t count AS "Count of DM_splunkops"   by DM_splunkops.component  | sort limit=100 DM_splunkops.component | fields - _span | rename "DM_splunkops.component" as component | fillnull "Count of DM_splunkops" | fields + component, "Count of DM_splunkops" | sort -"Count of DM_splunkops" | head 10</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.legend.placement">top</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <set token="tok_cell2">$click.value$</set>
          <link>#hidden_drilldown_2</link>
        </drilldown>
      </chart>
      <chart>
        <title>Top 10 - WARNs by Component</title>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false count as "Count of DM_splunkops" FROM datamodel=DM_splunkops.DM_splunkops WHERE (nodename=DM_splunkops "DM_splunkops.log_level"=WARN "DM_splunkops.host_short_name"="*") BY "DM_splunkops.component" DM_splunkops.host_short_name | stats dedup_splitvals=t count AS "Count of DM_splunkops" by DM_splunkops.component | sort limit=100 DM_splunkops.component | fields - _span | rename "DM_splunkops.component" as component | fillnull "Count of DM_splunkops" | fields + component, "Count of DM_splunkops" | sort -"Count of DM_splunkops" | head 10</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.legend.placement">top</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <set token="tok_cell2">$click.value$</set>
          <link>#hidden_drilldown_2</link>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel id="hidden_drilldown" depends="$tok_cell$">
      <title>Splunk Operations Analysis - $tok_cell$</title>
      <chart>
        <title>Column: Perc50(Median) value of the % of the queue is full   Overlay: Perc95 of % of the queue fill found</title>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false values("DM_resourcelogdata.q_perc_filled") as "Distinct Values of q_perc_filled" FROM datamodel=DM_resourcelogdata.DM_resourcelogdata WHERE (nodename=DM_resourcelogdata "DM_resourcelogdata.host_short_name"="$tok_cell$" "DM_resourcelogdata.q_perc_filled"=*) BY "DM_resourcelogdata.name" | stats dedup_splitvals=t values(DM_resourcelogdata.q_perc_filled) AS vals_queue_fill by DM_resourcelogdata.name | sort limit=100 DM_resourcelogdata.name | fields - _span | rename "DM_resourcelogdata.name" as name | fields + name, vals_queue_fill | chart perc50(vals_queue_fill) AS P50 perc95(vals_queue_fill) AS P95 by name | sort -P50</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisY2.enabled">1</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.overlayFields">P95</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.drilldown">all</option>
        <option name="height">500</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <unset token="tok_sourcetype"></unset>
        </drilldown>
      </chart>
    </panel>
    <panel id="hidden_drilldown_2" depends="$tok_cell2$">
      <title>Splunk Operations Analysis</title>
      <table>
        <title>ERRORs by Component  - $tok_cell2$</title>
        <search>
          <query>index=pfc log_level=ERROR sourcetype=splunkd_log component=$tok_cell2$ | top host_short_name event_message | sort -count | fields - percent</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">5</option>
        <option name="drilldown">cell</option>
        <drilldown>
          <link target="_blank">search?q=index%3Dpfc%20log_level%3DERROR%20sourcetype%3Dsplunkd_log%20component%3D$tok_cell2$%20%7C%20top%20host_short_name%20event_message%20%7C%20sort%20-count%20%7C%20fields%20-%20percent&amp;earliest=$field1.earliest$&amp;latest=$field1.latest$</link>
        </drilldown>
      </table>
      <table>
        <title>WARNings by Component  - $tok_cell2$</title>
        <search>
          <query>index=pfc log_level=WARN sourcetype=splunkd_log component=$tok_cell2$ | top host_short_name event_message | sort -count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">5</option>
        <option name="drilldown">cell</option>
        <drilldown>
          <link target="_blank">search?q=index%3Dpfc%20log_level%3DWARN%20sourcetype%3Dsplunkd_log%20component%3D$tok_cell2$%20%7C%20top%20host_short_name%20event_message%20%7C%20sort%20-count&amp;earliest=$field1.earliest$&amp;latest=$field1.latest$</link>
        </drilldown>
      </table>
    </panel>
  </row>
</form>