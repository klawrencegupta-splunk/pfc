<form stylesheet="tabs.css">
  <label>Splunk Pre-Flight Check - Resource Utilization -- experimental metrics</label>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="field1">
      <label>Time Range</label>
      <default>
        <earliest>0</earliest>
        <latest></latest>
      </default>
    </input>
  </fieldset>
  <row id="tabs">
    <panel>
      <html> 
      <ul id="tabs" class="nav nav-tabs"> 
      <li> <a href="/app/pfc/pfc_lander" class="toggle-tab" data-toggle="tab">Landing Page</a> </li> 
      <li class="active"> <a href="/app/pfc/splunk_preflight_check__resource_utilization" class="toggle-tab" target="_self">Resource Usage</a> </li>  
      <li> <a href="/app/pfc/splunk_preflight_check__splunk_operations" class="toggle-tab" data-toggle="tab" target="_self">Splunk Operations</a> </li> 
      <li> <a href="/app/pfc/splunk_preflight_check__splunk_search_analysis" class="toggle-tab" data-toggle="tab" target="_self">Splunk Search Review</a> </li> 
       <li> <a href="/app/pfc/splunk_preflight_check__summary_report" class="toggle-tab" data-toggle="tab" target="_self">Splunk PFC Summary Report</a> </li> </ul>
      </html>
    </panel>
  </row>
  <row>
    <panel id="readme">
      <html>
  <head>
  </head>
  <body>
          <span style="font-family: Avenir;"> </span>
    <h1> <span style="font-family: Avenir;">Resource Utilization Information</span>
    </h1>
    <span style="font-family: Avenir;"> </span>
    <p>
            <span style="font-family: Avenir;">All Splunk deployments require
        Compute, Memory and Storage to operate. 
      </span>
          </p>
    <p>
            <span style="font-family: Avenir;">This dashboard will help review the <strong>3
          most common Key Performance Indicators </strong>that can help
        identify resource-based trouble in a Splunk deployment.</span>
          </p>
    <span style="font-family: Avenir;"> </span>
    <p> <span style="font-family: Avenir;">
              <u>
                <p/>
                <strong>CPU Utilization</strong>
              </u>
        - Splunk measures the Hostwide level of CPU availability by capturing
        the % of the time a host is idle (or not processing requests). The field
        <strong>data.cpu_idle_pct</strong> is in the <strong>_introspection</strong>
        logs and captures this metric on a per minute basis.</span>
          </p>
              <u>
                <p/>
                <strong>Memory Utilization</strong>
              </u>
        - Splunk measures the amount of memory allocated used in the
        Hostwide component of the <strong>_introspection</strong> log data with
        the fields <strong>data.mem</strong>
          <strong>data.mem_used.</strong>
        This is represented as % in the table condition.
<p>
    <span style="font-family: Avenir;"> </span>
<u>
  <p/>
                <strong>Storage Utilization</strong>
              </u> - One of Splunk's most
        basic operations requires reading and writing data to disk. This happens
        either in the form of Ingest or through Search operations. Splunk
        measures this response time as the time in ms that the host has to wait
        for the storage to become available to process the request. This is
        captured in the <strong>data.avg_total_ms
        </strong> field within the <strong>IOstats</strong> component data
        within the <strong>_introspection</strong> index.</p>
        
            <p>
            <span style="font-family: Avenir;">Metrics are based on the following
        statistics:
      </span>
          </p>
    <ul>
      <li>
              <span style="font-family: Avenir;">perc25(CPU) AS <strong>CPU</strong>
          - top 25th percentile of CPU Idle activity by host</span>
            </li>
      <li>
              <span style="font-family: Avenir;">perc25(MEM) AS <strong>MEM</strong>
          - top 25th percentile of % of MEMory utilization by host</span>
            </li>
      <li>
              <span style="font-family: Avenir;">perc75(STORAGE) AS <strong>STORAGE</strong>
          - top 75th percentile of IOwait by host</span>
            </li>
    </ul>

  </body>
</html>
    </panel>
    <panel id="deploymentinfo">
      <html>
      <style>
          #readme{
            width:40% !important;
          }
          #deploymentinfo{
            width:60% !important; 
            }
          #hostinfo{
            width:75% !important;
          }
          #systeminfo{
            width:50%;
          }
          #readme2{
            width:100% !important;
          }
        </style>
        </html>
      <html depends="$alwaysHideCSSStyle$">
    <style>
       .table th {
          background-image: linear-gradient(to bottom, #34495E, #34495E) !important;
          text-shadow: none !important;
       }
       .table th a{
          color: white !important;
       }
      table tr.odd td{
        background: #F8F9F9 !important;
      }
      table tr.even td{
        background: #CACFD2 !important;
      }
      table tr td{
        color: #00000 !important;
      }
    </style>
  </html>
      <table id="tableRowColorWithoutJS">
        <title>!! -- Drilldown for time-based details on CPU, Memory &amp; Storage utilization by the Host name column</title>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false values("DM_resourcelogdata.data.cpu_idle_pct") as "values of data.cpu_idle_pct", values("DM_resourcelogdata.data.avg_total_ms") as "values of data.avg_total_ms", values("DM_resourcelogdata.data.mem_perc_used") as "values of Memory % used" FROM datamodel=DM_resourcelogdata.DM_resourcelogdata WHERE (nodename=DM_resourcelogdata "DM_resourcelogdata.host_short_name"="*") BY "DM_resourcelogdata.host_short_name" | stats dedup_splitvals=t values(DM_resourcelogdata.data.cpu_idle_pct) AS CPU values(DM_resourcelogdata.data.avg_total_ms) AS STORAGE values(DM_resourcelogdata.data.mem_perc_used) AS MEM by DM_resourcelogdata.host_short_name | stats perc25(CPU) AS CPU perc25(MEM) AS MEM perc75(STORAGE) AS STORAGE by DM_resourcelogdata.host_short_name
| eval "CPU Status"=if(CPU&gt;45.00, "✅", "❌") 
| eval "Memory Status"=if(MEM&lt;35.00, "✅", "❌")
| eval "Storage Status"=if(STORAGE&lt;10.00, "✅", "❌")
| rename DM_resourcelogdata.host_short_name AS host_short_name | lookup host_role.csv host_short_name OUTPUT role
| table host_short_name role *Status CPU MEM STORAGE</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">25</option>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <format type="color" field="cpu_exhaustion_status">
          <colorPalette type="map">{"CPU Exhaustion Found":#F08080}</colorPalette>
        </format>
        <format type="color" field="high_memutil_status">
          <colorPalette type="map">{"High Memory Utilization Found":#F08080}</colorPalette>
        </format>
        <format type="color" field="storage_contention_status">
          <colorPalette type="map">{"Storage Contention Found",#F08080)</colorPalette>
        </format>
        <drilldown>
          <condition field="host_short_name">
            <set token="tok_cell">$click.value$</set>
            <link>#systeminfo</link>
          </condition>
        </drilldown>
      </table>
      <html>
  <head>
  </head>
  <body>
    <hr/>
    <span style="font-family: Avenir;"> </span>
    <p> <span style="font-family: Avenir;">If "CPU Status" is ❌ the following condition has been met:</span>
          </p>
    <span style="font-family: Avenir;"> </span>
    <address> <span style="font-family: Avenir;"> <strong>the 25th percentile of CPU
          idle availability is &lt;45.00%</strong> </span> </address>
    <span style="font-family: Avenir;"> </span>
    <p> <u> <span style="font-family: Avenir;">When this condition is flagged
          the following customer conditions are also likely</span> </u> </p>
    <span style="font-family: Avenir;"> </span>
    <ul>
      <li> <span style="font-family: Avenir;">Slow or incomplete searches</span>
      </li>
      <li> <span style="font-family: Avenir;">Skipped searches</span> </li>
      <li> <span style="font-family: Avenir;">Bundle Replication Failures</span>
      </li>
    </ul>
    <p> <span style="font-family: Avenir;">If "Memory Status" is ❌ the following condition has been met:</span>
          </p> 
    <p/>
    <span style="font-family: Avenir;"> </span>
    <address> <span style="font-family: Avenir;">
        <p> <strong>the 25th percentile of <span style="font-family: Avenir;">Hostwide</span>
          memory utilization is higher than 35%</strong> </p>
      </span> </address>
    <span style="font-family: Avenir;">
      <p> <u>When this condition is flagged the following customer conditions
          are also likely</u> </p>
      <ul>
        <li>Splunk is crashing</li>
        <li>Searches fail to complete </li>
      </ul>
    <span style="font-family: Avenir;">If the <strong>"Storage 
        Status is ❌" </strong> condition has been flagged then the following
      condition has been met: </span>
          <p/>
        <address>
          <p> <strong>any mounted volume on the host has over <strong>10ms</strong> of IOwait time based
            on perc75 percentile distribution</strong></p>
        </address>
 <span style="font-family: Avenir;">
        <p> <u>When this condition is flagged the following customer conditions
            are also likely</u> </p>
            </span>
        <ul>
          <li>Ingest data is delayed</li>
          <li>Splunk Queues are blocked</li>
          <li>Searches fail to complete </li>
          <li>Knowledge Bundle Replications fails to complete</li>
        </ul>
      </span>
  </body>
</html>
    </panel>
  </row>
  <row>
    <panel id="systeminfo" depends="$tok_cell$">
      <title>Infrastructure Resource Utilization</title>
      <chart>
        <title>CPU Idle Activity - $tok_cell$ - perc25 &amp; perc50 value % of CPU in an IDLE state  --- over time span=1h</title>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false perc25(DM_resourcelogdata.data.cpu_idle_pct) AS "perc25 data.cpu_idle_pct" perc50("DM_resourcelogdata.data.cpu_idle_pct") as "perc50 of data.cpu_idle_pct" FROM datamodel=DM_resourcelogdata.DM_resourcelogdata WHERE (nodename=DM_resourcelogdata "DM_resourcelogdata.host_short_name"="$tok_cell$") BY _time span=2m | eval "DM_resourcelogdata.host_short_name"='DM_resourcelogdata.host_short_name', _time='_time' | timechart  dedup_splitvals=t limit=100 useother=t perc25(DM_resourcelogdata.data.cpu_idle_pct) AS "perc25 data.cpu_idle_pct" perc50(DM_resourcelogdata.data.cpu_idle_pct) AS "perc50 data.cpu_idle_pct" span=1h</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">linear</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.overlayFields">"perc25 data.cpu_idle_pct"</option>
        <option name="charting.chart.showDataLabels">minmax</option>
        <option name="charting.drilldown">all</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <unset token="tok_sourcetype"></unset>
        </drilldown>
      </chart>
      <chart>
        <title>CPU System &amp; User % Activity - $tok_cell$ -  perc75 &amp; perc50 % of CPU that is in an SYSTEM/USER state over time span=1h</title>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false perc75("DM_resourcelogdata.data.cpu_system_pct") as "perc75 of data.cpu_system_pct", perc75("DM_resourcelogdata.data.cpu_user_pct") as "perc75 of data.cpu_user_pct" perc50("DM_resourcelogdata.data.cpu_system_pct") as "perc50 of data.cpu_system_pct", perc50("DM_resourcelogdata.data.cpu_user_pct") as "perc95 of data.cpu_user_pct" FROM datamodel=DM_resourcelogdata.DM_resourcelogdata WHERE (nodename=DM_resourcelogdata "DM_resourcelogdata.host_short_name"="$tok_cell$") BY _time span=1h, "DM_resourcelogdata.host_short_name" | eval "DM_resourcelogdata.host_short_name"='DM_resourcelogdata.host_short_name', _time='_time'
| timechart dedup_splitvals=t limit=100 perc75("DM_resourcelogdata.data.cpu_system_pct") as "perc75 of data.cpu_system_pct", perc75("DM_resourcelogdata.data.cpu_user_pct") as "perc75 of data.cpu_user_pct" perc50("DM_resourcelogdata.data.cpu_system_pct") as "perc50 of data.cpu_system_pct", perc50("DM_resourcelogdata.data.cpu_user_pct") as "perc50 of data.cpu_user_pct" span=1h</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">log</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.overlayFields">"perc75 of data.cpu_system_pct","perc75 of data.cpu_user_pct"</option>
        <option name="charting.chart.showDataLabels">minmax</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.placement">right</option>
        <option name="height">394</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.splitBy">_aggregation</option>
        <drilldown>
          <unset token="tok_sourcetype"></unset>
        </drilldown>
      </chart>
      <chart>
        <title>Memory Utilization - $tok_cell$ - maximum value % of MEMory that is in use over time span=15m</title>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false max("DM_resourcelogdata.data.mem_perc_used") as "max mem", min("DM_resourcelogdata.data.mem_perc_used") as "min mem" FROM datamodel=DM_resourcelogdata.DM_resourcelogdata WHERE (nodename=DM_resourcelogdata "DM_resourcelogdata.host_short_name"="$tok_cell$") BY _time span=15m DM_resourcelogdata.host_short_name | eval _time='_time' | chart dedup_splitvals=t max(DM_resourcelogdata.data.mem_perc_used) AS "max mem" over _time by DM_resourcelogdata.host_short_name</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.showDataLabels">minmax</option>
        <option name="charting.drilldown">all</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <unset token="tok_sourcetype"></unset>
        </drilldown>
      </chart>
      <chart>
        <title>Disk Utilization by mount point - $tok_cell$ - perc75 value in ms of IOwait by the mount_point in legend over time span=30m</title>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false perc75("DM_resourcelogdata.data.avg_total_ms") as STORAGE, perc10("DM_resourcelogdata.data.cpu_idle_pct") as CPU, perc50("DM_resourcelogdata.data.mem_perc_used") as MEM FROM datamodel=DM_resourcelogdata.DM_resourcelogdata WHERE (nodename=DM_resourcelogdata "DM_resourcelogdata.host_short_name"="$tok_cell$") BY _time "DM_resourcelogdata.host_short_name" "DM_resourcelogdata.data.mount_point" span=30m | chart perc75(DM_resourcelogdata.data.avg_total_ms) AS STORAGE over _time by DM_resourcelogdata.data.mount_point</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.showDataLabels">minmax</option>
        <option name="charting.drilldown">all</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <unset token="tok_sourcetype"></unset>
        </drilldown>
      </chart>
    </panel>
  </row>
</form>