<form script="run_action.js" stylesheet="tabs.css">
  <label>DEMO -- v1.2 ---- Splunk Pre-Flight Check - Landing Page</label>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="field1">
      <label>Time Range</label>
      <default>
        <earliest>0</earliest>
        <latest></latest>
      </default>
    </input>
  </fieldset>
  <row id="tabs">
    <panel>
      <html> 
      <ul id="tabs" class="nav nav-tabs"> 
      <li class="active"> <a href="/app/pfc/splunk_preflight_check__pfclander" class="toggle-tab" data-toggle="tab">Landing Page</a> </li> 
      <li> <a href="/app/pfc/splunk_preflight_check__resource_utilization" class="toggle-tab" target="_self">Resource Usage</a> </li>  
      <li> <a href="/app/pfc/splunk_preflight_check__splunk_operations" class="toggle-tab" data-toggle="tab" target="_self">Splunk Operations</a> </li> 
      <li> <a href="/app/pfc/splunk_preflight_check__splunk_search_analysis" class="toggle-tab" data-toggle="tab" target="_self">Splunk Search Review</a> </li> 
       <li> <a href="/app/pfc/splunk_preflight_check__summary_report" class="toggle-tab" data-toggle="tab" target="_self">Splunk PFC Summary Report</a> </li> </ul>
      </html>
    </panel>
  </row>
  <row>
    <panel id="readme">
      <html>
  <head>
  </head>
  <body>
    <h1>
            <span style="font-family: Avenir;">Welcome to the Pre-Flight Check
        Landing Page</span>
          </h1>
    <h3>
            <span style="font-family: Avenir;">Let's get started with 2 easy steps!</span>
          </h3>
      <li>
            <span style="font-family: Avenir;">Collect your diags and follow
          either GDI option below <i>*release note: PFC is currently only
            supported on a Linux OS based host</i>
            </span>
          </li>
      <li>
            <span style="font-family: Avenir;">Create Lookup File to populate
          Dashboards and Data models</span>
          </li>
    <h3>
            <u>
              <span style="font-family: Avenir;">Step 1</span>
            </u>
          </h3>
    <span style="font-family: Avenir;">Use the <strong>GDI.py</strong> script
      available in the <strong>apps/pfc/bin</strong> directory to index the
      diag data correctly. The GDI.py <strong>python3</strong> script will take
      diags in their native .tar.gz format &amp; unzip/extract to the <strong>apps/pfc/downloads/full</strong>
      directory &amp; <strong>restart</strong> Splunk to begin the indexing
      process.
      <p> </p>
      <p> <u>
                <strong>There are 2 options available for automated GDI:</strong>
              </u>
      </p>
      <p> <strong>S3:</strong> To download diag files from an S3 bucket boto3 +
        awscli must be installed (via pip3) and the AWS Access/Secret Keys
        configured via /usr/local/bin aws configure script. This will enable the
        GDI.py script to download diag files from an S3 bucket supplied by the
        user at run-time. </p>
      <p> <strong>Manual Ingest:</strong> Alternately you can copy the diag
        files directly to the instance running the Splunk PFC app. Run the
        GDI.py script to process the diag files automatically. This option only
        requires that the user provide a local path (e.g. /home/splunker/) on
        the same instance as Splunk PFC. </p>
      <h3>
              <u>
                <span style="font-family: Avenir;">Step 2</span>
              </u>
            </h3>
      <span style="font-family: Avenir;">Use the "Create Lookup" button below to
        populate the dashboards &amp; the data models </span>
      <p> <button class="btn btn-primary button1">Create Lookup File</button> </p>
    </span>
  </body>
</html>
    </panel>
    <panel id="deploymentinfo">
      <title>Deployment Info</title>
      <html>
      <style>
          #readme{
            width:35% !important;
            height:550px !important;
            }
          #deploymentinfo{
            width:65% !important; 
            }
          #hostinfo{
            width:100% !important;
          }
          #systeminfo{
            width:100% !important;
          }
        </style>
        </html>
      <single>
        <title>Drilldown for complete list of Search Heads</title>
        <search>
          <query>index=pfc (sourcetype=splunkd_log AND site) OR (sourcetype=metrics_log sourceHost OR Peer_Count) OR (sourcetype="peers_csv") OR (sourcetype=audit_log action=search "search/jobs/" NOT "search/jobs/16*") 
| rex field=_raw "remote.(?&lt;origin_sh&gt;.{1,25})_subsearch" 
| eval index_count=mvcount(split(searchable_indexes,","))-1 
| stats dc(origin_sh) AS "# of SH" max(Peer_Count) AS "# of IDX" dc(sourceHost) AS "Forwarder count" max(index_count) AS "Index Count" | table "# of SH"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorMode">block</option>
        <option name="height">75</option>
        <option name="drilldown">all</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x3F8AC1","3F8AC1"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.size">small</option>
        <option name="underLabel">Search Heads Found</option>
        <option name="useColors">1</option>
        <drilldown>
          <link target="systeminfo">search?q=index%3Dpfc%20(sourcetype%3Dsplunkd_log%20AND%20site)%20OR%20(sourcetype%3Dmetrics_log%20sourceHost%20OR%20Peer_Count)%20OR%20(sourcetype%3D%22peers_csv%22)%20OR%20(sourcetype%3Daudit_log%20action%3Dsearch%20%22search%2Fjobs%2F%22%20NOT%20%22search%2Fjobs%2F16*%22)%20%20%20sourcetype%3Daudit_log%20%7C%20rex%20field%3D_raw%20%22remote.(%3F%3Corigin_sh%3E.%7B1%2C25%7D)_subsearch%22%20%20%7C%20stats%20dc(origin_sh)%20AS%20%22Search%20Head%20Count%22%20values(origin_sh)%20AS%20%22Search%20Heads%20Found%22&amp;earliest=$field1.earliest$&amp;latest=$field1.latest$</link>
        </drilldown>
      </single>
      <single>
        <title>Drilldown for complete list of Indexers</title>
        <search>
          <query>index=pfc (sourcetype=splunkd_log AND site) OR (sourcetype=metrics_log sourceHost OR Peer_Count) OR (sourcetype="peers_csv") OR (sourcetype=audit_log action=search "search/jobs/" NOT "search/jobs/16*") 
| rex field=_raw "remote.(?&lt;origin_sh&gt;.{1,25})_subsearch" 
| eval index_count=mvcount(split(searchable_indexes,","))-1 
| stats dc(origin_sh) AS "# of SH" max(Peer_Count) AS "# of IDX" dc(sourceHost) AS "Forwarder count" max(index_count) AS "Index Count" | table "# of IDX"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorMode">block</option>
        <option name="height">75</option>
        <option name="drilldown">all</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["DC9647","DC9647"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.size">small</option>
        <option name="underLabel">Indexers Found</option>
        <option name="useColors">1</option>
        <drilldown>
          <link target="_blank">search?q=index%3Dpfc%20peer_name%20OR%20peer_count%20%7C%20stats%20values(peer_name)%20dc(peer_name)&amp;earliest=$field1.earliest$&amp;latest=$field1.latest$</link>
        </drilldown>
      </single>
      <single>
        <title>Drilldown for a count of admin users by role</title>
        <search>
          <query>| tstats prestats=true summariesonly=false allow_old_summaries=false dc("DM_searchdata.user") as "Distinct Count of user" FROM datamodel=DM_searchdata.DM_searchdata WHERE nodename=DM_searchdata | stats dedup_splitvals=t dc(DM_searchdata.user) AS "Distinct Count of user"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">all</option>
        <option name="height">75</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["3F8AC1","3F8AC1"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.size">small</option>
        <option name="underLabel">Users Found</option>
        <option name="useColors">1</option>
        <drilldown>
          <link target="_blank">search?q=index%3Dpfc%20user%20AND%20roles%20sourcetype%3Daudit_log%20NOT%20(user%3Dsplunk-system-user%20OR%20skipping)%20%7C%20eval%20roles_exp%3Dsplit(roles%2C%20%22%2B%22)%20%20%7C%20stats%20dc(user)%20AS%20users%20by%20roles_exp%20%7C%20eval%20roles_exp%3Dtrim(replace(roles_exp%2C%20%22'%22%2C%20%22%22))%20%7C%20stats%20sum(users)%20by%20roles_exp%20%7C%20search%20roles_exp%3D*admin*%20%7C%20addcoltotals&amp;earliest=$field1.earliest$&amp;latest=$field1.latest$</link>
        </drilldown>
      </single>
      <single>
        <title>Drilldown for complete list of Indexes</title>
        <search>
          <query>index=pfc (sourcetype=splunkd_log AND site) OR (sourcetype=metrics_log sourceHost OR Peer_Count) OR (sourcetype="peers_csv") OR (sourcetype=audit_log action=search "search/jobs/" NOT "search/jobs/16*") 
| rex field=_raw "remote.(?&lt;origin_sh&gt;.{1,25})_subsearch" 
| eval index_count=mvcount(split(searchable_indexes,","))-1 
| stats dc(origin_sh) AS "# of SH" max(Peer_Count) AS "# of IDX" dc(sourceHost) AS "Forwarder count" max(index_count) AS "Index Count" | table "Index Count" </query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorMode">block</option>
        <option name="height">75</option>
        <option name="drilldown">all</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["DC9647","DC9647"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.size">small</option>
        <option name="underLabel">Index Count</option>
        <option name="useColors">1</option>
        <drilldown>
          <link target="_blank">search?q=index%3Dpfc%20sourcetype%3Dpeers_csv%20%7C%20eval%20val_indexes%3Dsplit(searchable_indexes%2C%20%22%2C%22)%20%7C%20stats%20dc(val_indexes)%20AS%20%22Index%20Count%22%20values(val_indexes)%20AS%20%22Index%20List%22&amp;earliest=$field1.earliest$&amp;latest=$field1.latest$</link>
        </drilldown>
      </single>
      <single>
        <title>Use chart to see Forwarder counts/type</title>
        <search>
          <query>index=pfc fwdType version&gt;0.0 NOT sourcetype=XML*  | rex field=version "(?&lt;mjv&gt;\d{1,2}.\d{1,2})." | chart dc(sourceIp) AS "# of Forwarders"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorMode">block</option>
        <option name="height">75</option>
        <option name="drilldown">all</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["5CC05C","5CC05C"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.size">small</option>
        <option name="underLabel">Forwarders Found</option>
        <option name="useColors">1</option>
      </single>
      <table>
        <title>*experimental -- vCPU Deployment Estimates - based on the min/max vCPU found per role * # of hosts found in the Search Head/Indexer roles</title>
        <search>
          <query>
            <![CDATA[index=pfc (sourcetype="resource_usage_log") OR (sourcetype=metrics_log Peer_Count) OR (sourcetype="peers_csv") | rex field=_raw "remote.(?<origin_sh>.{1,25})_subsearch"| lookup host_role.csv host_short_name OUTPUT role  | search NOT role=cluster_master | stats max(Peer_Count) AS idx_count dc(origin_sh) AS sh_count max(data.virtual_cpu_count) AS max_vcpu min(data.virtual_cpu_count) AS min_vcpu by role | eval min_vcpu_estimate=(idx_count+sh_count)*min_vcpu | eval max_vcpu_estimate=(idx_count+sh_count)*max_vcpu | where isnotnull(max_vcpu_estimate) | rename min_vcpu_estimate AS "Minimum vCPU Estimate" | rename max_vcpu_estimate AS "Maximum vCPU Estimate" | table "*Estimate"]]>
          </query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
      </table>
      <chart>
        <title>Distribution of Forwarders by Versions</title>
        <search>
          <query>index=pfc fwdType version&gt;0.0 NOT sourcetype=XML*  | rex field=version "(?&lt;mjv&gt;\d{1,2}.\d{1,2})." | eval fwdType=if(mjv &lt;= 2.5,"cribl",fwdType) | chart dc(sourceIp) AS "# of Forwarders" over mjv by fwdType | sort -mjv</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.placement">right</option>
        <option name="height">393</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">0</option>
        <option name="trellis.splitBy">mjv</option>
      </chart>
    </panel>
    <panel id="hostinfo">
      <title>Host Information - Drill Down on host_short_name to see Disk Layout Details &amp; Usage Information</title>
      <html depends="$alwaysHideCSSStyle$">
    <style>
       .table th {
          background-image: linear-gradient(to bottom, #34495E, #34495E) !important;
          text-shadow: none !important;
       }
       .table th a{
          color: white !important;
       }
      table tr.odd td{
        background: #F8F9F9 !important;
      }
      table tr.even td{
        background: #CACFD2 !important;
      }
      table tr td{
        color: #00000 !important;
      }
    </style>
  </html>
      <table>
        <search>
          <query>index=pfc sourcetype="resource_usage_log" OR (sourcetype=systeminfo_txt AND build) | stats max(data.cpu_count) AS phys_cpu max(data.virtual_cpu_count) AS vcpu max(data.mem) AS mem_kb max(data.splunk_version) AS  splunk_version by host_short_name host | eval vcpu=tonumber(vcpu) | eval phys_cpu=tonumber(phys_cpu) | eval ht_status=if(vcpu&gt;phys_cpu,"HT enabled", "HT NOT Enabled") | lookup host_role.csv host_short_name OUTPUT role | eval "Memory GB"=mem_kb/1024  | table host host_short_name role splunk_version ht_status phys_cpu vcpu "Memory GB" splunk_version | rename host AS "Diag File Path" | rename role AS Role | rename splunk_version AS "Splunk Version" | rename ht_status AS "Hyper-Threading Status" | rename phys_cpu AS "Physical CPUs" | rename vcpu AS "vCPU"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">15</option>
        <option name="drilldown">cell</option>
        <option name="rowNumbers">true</option>
        <format type="color" field="host_short_name">
          <colorPalette type="list">[#fff]</colorPalette>
        </format>
        <drilldown>
          <condition field="host_short_name">
            <set token="tok_cell">$click.value$</set>
            <link>#systeminfo</link>
          </condition>
          <condition>
            <!-- DO NOTHING WHEN ANYTHING ELSE IS CLICKED-->
          </condition>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel id="systeminfo" depends="$tok_cell$">
      <title>System Information</title>
      <table>
        <title>Additional Host Details - $tok_cell$</title>
        <search>
          <query>index=pfc host=*$tok_cell$* sourcetype="systeminfo_txt" OR sourcetype=resource_usage_log | stats
last(splunk_home_var)
last(splunk_etc_var)
last(kernel_version) last(data.os_version)
by host_short_name</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">10</option>
        <drilldown>
          <unset token="tok_sourcetype"></unset>
        </drilldown>
      </table>
      <table>
        <title>Disk Table Layout - $tok_cell$</title>
        <search>
          <query>index=pfc host=*$tok_cell$* sourcetype=systeminfo_txt  ("**********" "/dev" NOT ("summary" OR "datamodel" OR hot))
|  rex field=_raw "(?&lt;fs&gt;.\\w+[\\s|\\W\\w]\\w+[\\s|\\W\\w+])\\s+(?&lt;onekblks&gt;\\d+)\\s+(?&lt;used&gt;\\d+)\\s+(?&lt;avail&gt;\\d+)\\s+(?&lt;use_perc&gt;\\d+)\\W\\s(?&lt;path&gt;.+)" max_match=500  
| eval availGB=round(avail/1000/1000, 2) 
| eval totalGB=round(onekblks/1000/1000, 2) 
| stats max(totalGB) AS totalGB max(availGB) AS availGB by fs path</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">20</option>
        <drilldown>
          <unset token="tok_sourcetype"></unset>
        </drilldown>
      </table>
      <chart>
        <title>Disk Utilization by mount point over $tok_cell$</title>
        <search>
          <query>index=pfc host=*$tok_cell$*  sourcetype=systeminfo_txt  ("**********" "/dev" NOT ("summary" OR "datamodel" OR hot))
|  rex field=_raw "(?&lt;fs&gt;.\\w+[\\s|\\W\\w]\\w+[\\s|\\W\\w+])\\s+(?&lt;onekblks&gt;\\d+)\\s+(?&lt;used&gt;\\d+)\\s+(?&lt;avail&gt;\\d+)\\s+(?&lt;use_perc&gt;\\d+)\\W\\s(?&lt;path&gt;.+)" max_match=200  
| eval availGB=round(avail/1000/1000, 2) 
| eval totalGB=round(onekblks/1000/1000, 2) 
| chart max(use_perc) AS use_perc over path by fs useother=f limit=25</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <unset token="tok_sourcetype"></unset>
        </drilldown>
      </chart>
    </panel>
  </row>
</form>